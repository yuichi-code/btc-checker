<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BTC ãã‚‡ã† & æŒ‡å®šæ—¥ï¼ˆæ—¥è¶³ï¼‰</title>
<style>
  :root{--bd:#e5e7eb;--fg:#111827;--muted:#6b7280}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:var(--fg);margin:16px;line-height:1.7}
  h1{font-size:1.15rem;margin:0 0 12px}
  .card{border:1px solid var(--bd);border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .mono{font-variant-numeric:tabular-nums;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace}
  .muted{color:var(--muted)}
  button{padding:10px 14px;border-radius:10px;border:1px solid var(--bd);background:#f9fafb}
  input[type="date"]{padding:10px;border-radius:10px;border:1px solid var(--bd)}
  .small{font-size:.92rem}
</style>
</head>
<body>
  <h1>BTC Now</h1>

  <!-- ä¸Šæ®µï¼šæœ€æ–°ï¼ˆã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«è‡ªå‹•ã§å‡ºã™ï¼‰ -->
  <div class="card" id="now-card">
    <div class="row" style="justify-content:space-between">
      <div class="muted small" id="now-ts">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
      <button id="reloadBtn" title="æœ€æ–°ã‚’å†å–å¾—">æ›´æ–°</button>
    </div>
    <div class="mono" id="now-usd">BTC (USD): -</div>
    <div class="mono" id="now-jpy">BTC (JPY): -</div>
    <div class="mono" id="now-usdjpy">USD/JPY : -</div>
    <div class="muted small" id="now-note">Binance REST API / Ticker</div>
  </div>

  <!-- ä¸‹æ®µï¼šæŒ‡å®šæ—¥ï¼ˆæ—¥è¶³ï¼‰ -->
  <div class="card">
    <div class="row">
      <label for="date" class="small">æ—¥ä»˜ã‚’é¸æŠï¼ˆJSTï¼‰</label>
      <input type="date" id="date" />
      <button id="fetchBtn">æŒ‡å®šæ—¥ã‚’å–å¾—</button>
    </div>
    <div class="muted small" id="day-head">æœªå–å¾—</div>
    <div class="mono" id="day-o">å§‹å€¤: -</div>
    <div class="mono" id="day-h">é«˜å€¤: -</div>
    <div class="mono" id="day-l">å®‰å€¤: -</div>
    <div class="mono" id="day-c">çµ‚å€¤: -</div>
    <div class="mono" id="day-vb">å‡ºæ¥é«˜(BTC): -</div>
    <div class="mono" id="day-vq">å‡ºæ¥é«˜(USDT): -</div>
    <div class="mono" id="day-trades">å–å¼•å›æ•°: -</div>
    <div class="muted small" id="day-note">Binance REST API / candlestick chart 1d</div>
  </div>

<script>
  // ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
  const fmtNum = (n, d=2) => Number(n).toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d});
  const fmtInt = (n) => Number(n).toLocaleString('en-US',{maximumFractionDigits:0});
  const fmtJST = (date)=> new Intl.DateTimeFormat('ja-JP',{
    timeZone:'Asia/Tokyo',year:'numeric',month:'2-digit',day:'2-digit',
    hour:'2-digit',minute:'2-digit',second:'2-digit'
  }).format(date).replace(/\./g,'/'); // Androidä¸€éƒ¨ã§ . åŒºåˆ‡ã‚Šå¯¾ç­–

  // ãã‚‡ã†(JST)ã‚’ <input type="date"> ç”¨ "YYYY-MM-DD" ã«
  function todayJstForInput(){
    const parts = new Intl.DateTimeFormat('ja-JP',{timeZone:'Asia/Tokyo',year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(new Date());
    const y = parts.find(p=>p.type==='year').value;
    const m = parts.find(p=>p.type==='month').value;
    const d = parts.find(p=>p.type==='day').value;
    return `${y}-${m}-${d}`;
  }

  // ===== æœ€æ–°ï¼ˆã„ã¾ï¼‰å–å¾— =====
  async function fetchNow(){
    document.getElementById('now-ts').textContent = fmtJST(new Date());
    document.getElementById('now-note').textContent = 'Binance REST API / Ticker';
    try{
      const [usdRes, jpyRes] = await Promise.all([
        fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT'),
        fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCJPY')
      ]);
      if(!usdRes.ok || !jpyRes.ok) throw new Error('æœ€æ–°ä¾¡æ ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');

      const usd = await usdRes.json();
      const jpy = await jpyRes.json();
      const btcUsd = parseFloat(usd.price);
      const btcJpy = parseFloat(jpy.price);
      const usdjpy = btcJpy / btcUsd;

      document.getElementById('now-usd').textContent    = `BTC (USD): ${fmtNum(btcUsd,2)}`;
      document.getElementById('now-jpy').textContent    = `BTC (JPY): ${fmtInt(btcJpy)}`;
      document.getElementById('now-usdjpy').textContent = `USD/JPY : ${fmtNum(usdjpy,2)}`;
    }catch(err){
      document.getElementById('now-note').textContent = `ã‚¨ãƒ©ãƒ¼: ${err.message}`;
    }
  }

  // ===== æŒ‡å®šæ—¥ï¼ˆæ—¥è¶³ï¼‰å–å¾— =====
  async function fetchDay(dateStr){ // "YYYY-MM-DD" (JST)
    if(!dateStr){
      document.getElementById('day-head').textContent = 'æ—¥ä»˜ãŒæœªå…¥åŠ›ã‚„ã§';
      return;
    }
    const jstMidnight = new Date(`${dateStr}T00:00:00+09:00`);
    const startMs = jstMidnight.getTime();

    document.getElementById('day-head').textContent = `${dateStr.replaceAll('-','/')} (JST) èª­ã¿è¾¼ã¿ä¸­â€¦`;
    try{
      const url = new URL('https://api.binance.com/api/v3/klines');
      url.search = new URLSearchParams({
        symbol:'BTCUSDT', interval:'1d', startTime:String(startMs), limit:'1'
      }).toString();

      const res = await fetch(url);
      if(!res.ok) throw new Error('æŒ‡å®šæ—¥ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
      const arr = await res.json();
      if(!arr || !arr.length){
        document.getElementById('day-head').textContent = 'ãã®æ—¥ã¯ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ã‚“ã‹ã£ãŸã§';
        return;
      }
      const k = arr[0];
      const open = parseFloat(k[1]), high = parseFloat(k[2]), low = parseFloat(k[3]), close = parseFloat(k[4]);
      const volB = parseFloat(k[5]);   // BTCå‡ºæ¥é«˜
      const volQ = parseFloat(k[7]);   // USDTå‡ºæ¥é«˜
      const trades = parseInt(k[8],10);

      document.getElementById('day-head').textContent = `${dateStr.replaceAll('-','/')} (JST)`;
      document.getElementById('day-o').textContent  = `å§‹å€¤: ${fmtNum(open,2)} USD`;
      document.getElementById('day-h').textContent  = `é«˜å€¤: ${fmtNum(high,2)} USD`;
      document.getElementById('day-l').textContent  = `å®‰å€¤: ${fmtNum(low,2)} USD`;
      document.getElementById('day-c').textContent  = `çµ‚å€¤: ${fmtNum(close,2)} USD`;
      document.getElementById('day-vb').textContent = `å‡ºæ¥é«˜(BTC): ${fmtNum(volB,4)} BTC`;
      document.getElementById('day-vq').textContent = `å‡ºæ¥é«˜(USDT): ${fmtNum(volQ,2)} USDT`;
      document.getElementById('day-trades').textContent = `å–å¼•å›æ•°: ${trades.toLocaleString('en-US')}`;
    }catch(err){
      document.getElementById('day-note').textContent = `ã‚¨ãƒ©ãƒ¼: ${err.message}`;
    }
  }

  // ===== åˆæœŸåŒ– =====
  (()=> {
    // ãã‚‡ã†ã‚’æ—¢å®šå€¤ã«
    document.getElementById('date').value = todayJstForInput();
    // æœ€æ–°ã‚’å³æ™‚å–å¾—
    fetchNow();
    // ãƒœã‚¿ãƒ³
    document.getElementById('fetchBtn').addEventListener('click', ()=> {
      fetchDay(document.getElementById('date').value);
    });
    document.getElementById('reloadBtn').addEventListener('click', fetchNow);
  })();
</script>
  <footer style="margin-top:2em; padding-top:1em; border-top:1px solid #ccc; font-size:0.9em; color:#666;">
    <p>
      <a href="index.html">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a>
    </p>
    <p>
      Data: Binance REST API<br>
      Developed by yuichi-code
    </p>
  </footer>
</body>
</html>
